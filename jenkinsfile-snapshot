#!/usr/bin/env groovy

// Use node dedicated to Java compilation
pipeline {
    agent any

    stages {

        // Clean workspace
        stage('Clean workspace') {
            steps {
                deleteDir()
            }

        }
        // Download source code
        stage('Preparation') {
            steps {
                checkout scm
            }
        }

        // Launch Maven
        stage('Build') {
            steps {
                mavenTask("clean install deploy")

                // Tell Mailer that it's a success

            }

        }

    }

}

def mavenTask(String command) {
    def MAVEN_BUILD=tool 'maven3'
    def JAVA_HOME=tool 'JDK_1.8.0_121'
    def NODE_HOME=tool 'node'

    if (isUnix()) {
        sh "'${MAVEN_BUILD}/bin/mvn' -e -U -B -X  ${command}"
    } else {
        withEnv(["JAVA_HOME=${JAVA_HOME}",
                 "PATH=${NODE_HOME};${env.PATH};${WORKSPACE}/spring-boot-angular-jenkins-web/node-modules/.bin"]) {
            bat (/"${MAVEN_BUILD}\bin\mvn.bat" -e -U -B ${command}/)
        }
    }
}
